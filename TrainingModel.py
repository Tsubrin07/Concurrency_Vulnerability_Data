import json
import spacy

# load data
with open('C:/Users/DELL/Downloads/Thesis wife/trainingData.json',
'r', encoding='utf-8') as f:
    data = json.load(f)

# define labels
LABELS = ['Version', 'Attacker', 'Reason', 'Impact', 'Result', 'Vector']

# load spaCy model
nlp = spacy.load('en_core_web_sm')

# add named entity recognition pipeline component
#ner = spacy.pipeline.EntityRecognizer(nlp.vocab)
#for label in labels:
#    ner.add_label(label)
#nlp.add_pipe('ner', source=ner)

ner = nlp.get_pipe("ner")
for label in LABELS:
    ner.add_label(label)
# train model
text = data['data']['ner']
doc = nlp(text)
entities = list(doc.ents)
annotations = data['annotations']
result = annotations[0]['result']
resultLength = len(result)
for i in range(0, resultLength-1):
    start = result[i]['value']['start']
    end = result[i]['value']['end']
    label = result[i]['value']['labels'][0]
    entity = (start, end, label)
    doc.ents = list(doc.ents) + [entity]
#nlp.update([doc], [])

# test model
test_text = 'A flaw was found in Linux Kernel because access to the
global variable fg_console is not properly synchronized leading to a
use after free in con_font_op.'
doc = nlp(test_text)
for ent in doc.ents:
    print(ent.text, ent.label_)